{% extends "base.html" %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div>
        <h1 class="text-3xl font-bold text-gray-900">Dashboard</h1>
        <p class="mt-1 text-sm text-gray-500">Vis√£o geral do sistema Jung Claude.</p>
    </div>

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div class="stat-label">üë• Usu√°rios Totais</div>
                <div class="stat-value">{{ total_users }}</div>
                <div style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">
                    Usu√°rios ativos no sistema
                </div>
            </div>
            <div class="stat-icon">üë•</div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div class="stat-label">üí¨ Intera√ß√µes Totais</div>
                <div class="stat-value">{{ total_interactions }}</div>
                <div style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">
                    Conversas processadas
                </div>
            </div>
            <div class="stat-icon">üí¨</div>
        </div>
    </div>

    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <div class="stat-label">‚ö° Conflitos Detectados</div>
                <div class="stat-value">{{ total_conflicts }}</div>
                <div style="color: #64748b; font-size: 0.875rem; margin-top: 0.5rem;">
                    Tens√µes psicol√≥gicas identificadas
                </div>
            </div>
            <div class="stat-icon">‚ö°</div>
        </div>
    </div>
</div>

{% if diagnostic_mode %}
<!-- Diagnostic Alert -->
<div class="card" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%); border-color: rgba(251, 191, 36, 0.3); margin-bottom: 2rem;">
    <div class="card-header" style="border-color: rgba(251, 191, 36, 0.2);">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="font-size: 2rem;">‚ö†Ô∏è</div>
            <div>
                <div class="card-title" style="color: #fbbf24;">Modo Diagn√≥stico</div>
                <div style="color: #fcd34d; font-size: 0.875rem; margin-top: 0.25rem;">Sistema em modo de diagn√≥stico</div>
            </div>
        </div>
    </div>

    <div style="background: rgba(0, 0, 0, 0.2); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
        <div style="font-weight: 600; color: #fbbf24; margin-bottom: 0.5rem;">Erro:</div>
        <div style="color: #fcd34d; font-family: monospace; font-size: 0.9rem;">{{ error_message }}</div>
    </div>

    {% if error_traceback %}
    <details style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 0.5rem; border: 1px solid rgba(239, 68, 68, 0.3); margin-top: 1rem;">
        <summary style="cursor: pointer; font-weight: 600; color: #fca5a5;">üîç Ver Traceback</summary>
        <pre style="margin-top: 1rem; padding: 1rem; background: rgba(0, 0, 0, 0.3); border-radius: 0.375rem; overflow-x: auto; font-family: monospace; font-size: 0.75rem; color: #fca5a5; max-height: 400px; overflow-y: auto;">{{ error_traceback }}</pre>
    </details>
    {% endif %}
</div>
{% endif %}

<!-- Quick Access Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">

    <a href="/admin/jung-lab" class="card" style="text-decoration: none; color: inherit; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 1rem;">
            <div style="font-size: 3.5rem;">üß†</div>
            <div>
                <div style="font-weight: 700; font-size: 1.4rem; color: #f1f5f9; margin-bottom: 0.25rem;">Jung Lab</div>
                <div style="color: #94a3b8; font-size: 0.95rem;">Rumina√ß√£o Cognitiva</div>
            </div>
        </div>
        <div style="padding-top: 1rem; border-top: 1px solid rgba(148, 163, 184, 0.1); color: #64748b; font-size: 0.875rem;">
            Sistema de processamento profundo de tens√µes psicol√≥gicas
        </div>
    </a>

    <a href="/admin/api/test/mbti" target="_blank" class="card" style="text-decoration: none; color: inherit; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 1rem;">
            <div style="font-size: 3.5rem;">üé≠</div>
            <div>
                <div style="font-weight: 700; font-size: 1.4rem; color: #f1f5f9; margin-bottom: 0.25rem;">Teste MBTI</div>
                <div style="color: #94a3b8; font-size: 0.95rem;">Tipos de Personalidade</div>
            </div>
        </div>
        <div style="padding-top: 1rem; border-top: 1px solid rgba(148, 163, 184, 0.1); color: #64748b; font-size: 0.875rem;">
            Avalia√ß√£o dos 16 tipos psicol√≥gicos (Myers-Briggs)
        </div>
    </a>

    <a href="/admin/api/test/desenvolvimento" target="_blank" class="card" style="text-decoration: none; color: inherit; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 1.5rem; margin-bottom: 1rem;">
            <div style="font-size: 3.5rem;">üå±</div>
            <div>
                <div style="font-weight: 700; font-size: 1.4rem; color: #f1f5f9; margin-bottom: 0.25rem;">Desenvolvimento</div>
                <div style="color: #94a3b8; font-size: 0.95rem;">Jornada de Individua√ß√£o</div>
            </div>
        </div>
        <div style="padding-top: 1rem; border-top: 1px solid rgba(148, 163, 184, 0.1); color: #64748b; font-size: 0.875rem;">
            An√°lise do processo de individua√ß√£o segundo Jung
        </div>
    </a>

</div>

<!-- Recent Users -->
<div class="card">
    <div class="card-header">
        <div>
            <h3 class="card-title">üë• Usu√°rios Recentes</h3>
            <p style="color: #64748b; font-size: 0.875rem; margin-top: 0.25rem;">√öltimos usu√°rios que interagiram com o sistema</p>
        </div>
        <a href="/admin/users" class="btn btn-secondary">Ver Todos ‚Üí</a>
    </div>

    {% if users %}
    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
        {% for user in users %}
        <div style="background: rgba(15, 23, 42, 0.5); padding: 1.25rem; border-radius: 0.75rem; border: 1px solid rgba(148, 163, 184, 0.1); transition: all 0.3s ease;"
             onmouseover="this.style.borderColor='rgba(139, 92, 246, 0.3)'; this.style.transform='translateX(4px)';"
             onmouseout="this.style.borderColor='rgba(148, 163, 184, 0.1)'; this.style.transform='translateX(0)';">
            <div style="display: flex; justify-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1.25rem;">
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%); display: flex; align-items: center; justify-center; font-weight: 700; font-size: 1.5rem; color: white; box-shadow: 0 4px 6px rgba(139, 92, 246, 0.3);">
                        {{ user.user_name[:2].upper() if user.user_name else 'U' }}
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #f1f5f9; font-size: 1.1rem;">{{ user.user_name or 'Usu√°rio An√¥nimo' }}</div>
                        <div style="font-family: monospace; font-size: 0.8rem; color: #64748b; margin-top: 0.25rem;">{{ user.user_id[:16] }}...</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 2rem; font-weight: 700; background: linear-gradient(135deg, #c4b5fd 0%, #ddd6fe 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                        {{ user.total_messages or 0 }}
                    </div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 0.25rem;">mensagens</div>
                    <div style="font-size: 0.75rem; color: #475569; margin-top: 0.5rem;">üìÖ {{ user.last_seen or 'N/A' }}</div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 4rem 2rem; color: #64748b;">
        <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.4;">üë§</div>
        <div style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">Nenhum usu√°rio encontrado</div>
        <div style="font-size: 0.95rem; opacity: 0.7;">Aguardando primeiras intera√ß√µes...</div>
    </div>
    {% endif %}
</div>

<!-- Additional Resources -->
<div style="margin-top: 2rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
    <a href="/admin/sync-check" class="card" style="text-decoration: none; color: inherit; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="font-size: 2.5rem;">üîç</div>
            <div>
                <div style="font-weight: 700; font-size: 1.1rem; color: #f1f5f9;">Diagn√≥stico</div>
                <div style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.25rem;">Status e sincroniza√ß√£o</div>
            </div>
        </div>
    </a>

    <a href="/admin/users" class="card" style="text-decoration: none; color: inherit; cursor: pointer;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div style="font-size: 2.5rem;">üìä</div>
            <div>
                <div style="font-weight: 700; font-size: 1.1rem; color: #f1f5f9;">An√°lises Detalhadas</div>
                <div style="color: #94a3b8; font-size: 0.875rem; margin-top: 0.25rem;">Perfis psicom√©tricos</div>
            </div>
        </div>
    </a>
</div>
{% endblock %}
